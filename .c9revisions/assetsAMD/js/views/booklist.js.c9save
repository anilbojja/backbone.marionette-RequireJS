{"ts":1346183649449,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// booklist.js\n// dependency array [...] is key to resolving module loading\n\ndefine(['require', 'jquery', 'underscore', 'backbone', 'app', 'views/book', 'text!templates/book-list-template.htm', 'marionette' ], function (require, $, _, Backbone, App, BookView, bookListTemplate ) {\n    'use strict';\n\n    var BookList = {};\n\n    var BookListView = Backbone.Marionette.CompositeView.extend({\n        template: _.template(bookListTemplate), //\"#book-list-template\",\n        id: \"bookList\",\n        itemView: BookView,\n\n        initialize: function () {\n            _.bindAll(this, \"showMessage\", \"loadMoreBooks\");\n            var self = this;\n            App.vent.on(\"search:error\", function () {\n                self.showMessage(\"Error, please retry later :s\");\n            });\n            App.vent.on(\"search:noSearchTerm\", function () {\n                self.showMessage(\"Hummmm, can do better :)\");\n            });\n            App.vent.on(\"search:noResults\", function () {\n                self.showMessage(\"No books found\");\n            });\n        },\n\n        events: {\n            'scroll': 'loadMoreBooks'\n        },\n\n        appendHtml: function (collectionView, itemView) {\n            collectionView.$(\".books\").append(itemView.el);\n        },\n\n        showMessage: function (message) {\n            this.$('.books').html('<h1 class=\"notFound\">' + message + '</h1>');\n        },\n\n        loadMoreBooks: function () {\n            var totalHeight = this.$('> div').height(),\n                scrollTop = this.$el.scrollTop() + this.$el.height(),\n                margin = 200;\n            // if we are closer than 'margin' to the end of the content, load more books\n            if (scrollTop + margin >= totalHeight) {\n                App.vent.trigger(\"search:more\");\n            }\n        }\n    });\n\n    BookList.showBooks = function (books) {\n        var bookListView = new BookListView({\n            collection: books\n        });\n        require('controllers/libraryapp').layout.books.show(bookListView);\n    };\n\n    return BookList;\n\n});"]],"start1":0,"start2":0,"length1":0,"length2":2042}]],"length":2042}
