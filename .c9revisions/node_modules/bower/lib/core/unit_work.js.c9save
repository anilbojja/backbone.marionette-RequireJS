{"ts":1353805457095,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// ==========================================\n// BOWER: Package Object Definition\n// ==========================================\n// Copyright 2012 Twitter, Inc\n// Licensed under The MIT License\n// http://opensource.org/licenses/MIT\n// ==========================================\n// Events:\n//  - lock: fired when a lock write over a key is acquired\n//  - unlock: fired when an unlock write over a key is acquired\n// ==========================================\n\nvar events   = require('events');\n\nvar UnitWork = function () {\n  this.locks = [];\n  this.data = [];\n\n  this.setMaxListeners(100);   // Increase the number of listeners because this is a central storage\n};\n\nUnitWork.prototype = Object.create(events.EventEmitter.prototype);\n\nUnitWork.prototype.constructor = UnitWork;\n\nUnitWork.prototype.lock = function (key, owner) {\n  if (this.locks[key]) throw new Error('A write lock for \"' + key + '\" was already acquired.');\n  if (!owner) throw new Error('A lock requires an owner.');\n  this.locks[key] = owner;\n\n  return this.emit('lock', key);\n};\n\nUnitWork.prototype.unlock = function (key, owner) {\n  if (!owner) throw new Error('A write lock requires an owner.');\n  if (this.locks[key]) {\n    if (this.locks[key] !== owner) throw new Error('Lock owner for  \"' + key + '\" mismatch.');\n    delete this.locks[key];\n    this.emit('unlock', key);\n  }\n\n  return this;\n};\n\nUnitWork.prototype.isLocked = function (key) {\n  return !!this.locks[key];\n};\n\nUnitWork.prototype.store = function (key, data, owner) {\n  if (this.locks[key] && owner !== this.locks[key]) throw new Error('A write lock for \"' + key + '\" is acquired therefore only its owner can write to it.');\n  this.data[key] = data;\n\n  return this;\n};\n\nUnitWork.prototype.retrieve = function (key) {\n  return this.data[key];\n};\n\nUnitWork.prototype.keys = function () {\n  return Object.keys(this.data);\n};\n\nmodule.exports = UnitWork;"]],"start1":0,"start2":0,"length1":0,"length2":1885}]],"length":1885}
